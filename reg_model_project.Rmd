---
title: "Modeling and prediction for movies"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(statsr)
```

### Load data

```{r load-data}
load("movies.Rdata")
```

* * *

## Part 1: Data

The data set is composed of 651 randomly sampled movies produced and released before 2016. We are not given information on whether the sampling was with or without replacement and how was the assignment of observations made. We can assume that each observation is independent from one another and the number of observations is reasonable. If so, the the results can be generalizable for all movies. However, because this was an observational study, the results can not be used to determine causation.

* * *

## Part 2: Research question

What attributes make a movie being popular? Popularity, in this study, will be understood as the rating given by the audience to the movies (i.e. variables such as audience_rating or imdb_rating), or in other words, how much did the audience like a movie. A popular movie, therefore, is one with a high score according to people's opinion and regardless of critic's opinion. Note that, another approach to measure popularity would be by using the number of votes that a movie gets on IMDB (i.e. imdb_num_votes). The number of votes may be representative of how many viewers a move got, and therefore its popularity regardless whether the votes are positive or negative.

By performing a regression analysis, the study will be able to tell about what attributes of a movie are more important in order to make a movie being popular. Do the actors weight more than the director in terms of popularity? Does the audience care about the nominations to the Oscars in order to rate a movie as popular? Do critics opinion affect the popularity? Many of this questions will be able to be addressed reading the parameters of the linear model to be built in the following steps.

* * *

## Part 3: Exploratory data analysis

Given the data set, some variables are there only for informational purposes. Some data cleaning have to be done before getting into the model selection step. More specifically, this study will omit the variables title, title_type, mpaa_rating, studio, thtr_rel_year, thtr_rel_month, thtr_rel_day, dvd_rel_year, dvd_rel_month, dvd_rel_day, imdb_url, rt_url. This study will not be concerned about release dates, movie formats, or studio.

Before getting into the model selection step to achieve the parsimonious model (the model that has the highest predictive power with the lowest possible variables), a study for variable independence must be done to avoid any kind of collinearity. Inclusion of collinear predictors complicates model estimation as the estimates coming of of the model may no longer be reliable.

Given the data set, potential collinear predictors are imdb_rating and audience_score, since they both represent audience opinions even though coming from different sources. Their similarity can be checked using the correlation funcion:

```{r}
plot(movies$imdb_rating, movies$audience_score)
cor(movies$imdb_rating, movies$audience_score)
```

Given the very high positive correlation, including both variables into the model would not be convinient. Therefore, imdb_rating will be used as the response variable to answer the research question, and audience_score will be discarted.

Similarly, critics_score and critics_rating are not independent since they report the same information on a different scale (categorical rather than numerical). It is also the case for audience_score, audiance_rating and imdb_rating. Hence, audiance_rating will also not be included in the model.

Since the purpose of this work is to build a linear model, linearity between the features and the response variable should also be checked.

```{r}
ggplot(data = movies, aes(x = critics_score, y = imdb_rating)) + geom_point()
cor(movies$critics_score, movies$imdb_rating)

ggplot(data = movies, aes(x = runtime, y = imdb_rating)) + geom_point()
cor(movies$runtime, movies$imdb_rating)

ggplot(data = movies, aes(x = imdb_num_votes, y = imdb_rating)) + geom_point()
cor(movies$imdb_num_votes, movies$imdb_rating)
```

Except for critics_score, imdb_num_votes and runtime show either a very weak or non-linear relationship with the response variable imdb_rating. Therefore, they will be dropped from the linear model.

A new categorical variable will be created to gather together whether a movie won an oscar of any kind, in a single variable.

```{r}
movies <- movies %>% mutate(oscar_win = ifelse(best_pic_win=="yes"| best_actor_win=="yes"|best_actress_win=="yes"|best_dir_win=="yes","yes","no"))
```

Checking the new variable together with the scores earned on IMDB:

```{r}
ggplot(mapping=aes(x = movies$oscar_win, y = movies$imdb_rating)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) + xlab("Oscar Won") + ylab("IMDB Audience Score") + ggtitle("Scores if Oscar Won")
```

The result seems reasonable. Movies that won an oscar tend to receive a higher IMDB Audience score. Therefore, it can be a potential predictor for popularity.

Last, it can be observed that scores have significantly different variabilities and medians with regards to the movie genere they belong to.

```{r}
ggplot(mapping=aes(x = movies$genre, y = movies$imdb_rating)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) + xlab("Movie Genre") + ylab("IMDB Audience Score") + ggtitle("Scores Given to Each Genre")
```

For instance, 'Documentray' is on average the highest rated movie genre. The lowest median belongs to movies tagged as 'Comedy'. It will be interesting to figure out whether it is a significant predictor to our model.

* * *

## Part 4: Modeling

To select only the good predictors within the independent variables left in the data set, a backwards elimination stepwise model selection method will used. Specifically, since the study wants to check for what attributes make a movie popular, or in other words which predictors are significant, the selection criteria will be based on the p-value.

The model begins with all variables left after the previous exploratory data analysis step. In each step, the predictor with the lowest p-value will be dropped until the model with only significant predictors is reached.

```{r}
model1 <- lm(imdb_rating ~ critics_score + genre + oscar_win + top200_box, data = movies)
summary(model1)
```

In this first full model, the non-significant variable with the highest p-value is top200_box. Therefore, this variable will be not included in the next model. The categorical variable is kept in the model since it appears to be significant for some levels.

```{r}
model2 <- lm(imdb_rating ~ critics_score + genre + oscar_win, data = movies)
summary(model2)
```

In this second model, all variables are significant at least at 10% significance level. Hence, the parcimonious linear model has been found. The categorical variable is kept in the model since it appears to be significant for some levels.

* * *

## Part 5: Prediction

The movie chosen to check the final model for unknown observations is: 

Fantastic Beasts and Where to Find Them (2016):
- Runtime (IMDB): 2h13m
- Number of IMDB votes: 163,019
- Critics Score (Rotten Tomatoes): 73
- Genre (IMDB): Science Fiction & Fantasy
- Actual IMDB Score: 7.6
- Oscar Win: No

```{r}
new_movie <- data.frame(critics_score = 73, genre = "Science Fiction & Fantasy", oscar_win = "no")
predict(model2, new_movie)
```

The predicted value for the new movie is 6.354864. Since the actual score is 7.6, the prediction error of the model has been 1.25 points.

```{r}
predict(model2, new_movie, interval = "prediction", level = 0.95)
```

The model is 95% confident that the actual score of the new movie is in the interval (4.948065, 7.752171). Since the actual score of the new movie is 7.6, the interval  captures the true score in its range.

* * *

## Part 6: Conclusion

In conclusion, according to the final model, what makes a movie popular given the variables available in the data set is, in order of prominence, its critics score, whether it won an oscar or not and finally the genre it belongs to. Remember that popularity in this model is measured as the score the audience gives to a movie. The higher the score is, the more popular the movie is considered.

All else held constant, every 1 point the critics add to a movie, the predicted score increases by 0.026368 points. Similarly, all else held constant, when a movie won an oscar of any kind, 0.107021 points are added to the audience score showing an increase in its popularity. The intercept as the average score given by the audience when the critics sore is zero and the move has not won any oscar. In addition, some levels of the categorical variable 'genre' are not significant, but the variable was included since for the categories Art House & International, Documentary, Comedy, Musical & Performing Arts and Science Fiction & Fantasy it turned out to be significant. Noticeably, the latter genre does not add points to the predicted score but subtracts.

However, according to the parameter Adjusted R-squared, the model only is able to explain 61.06% of the response variable. All the variables not included explain what is left. Therefore, to build a more robust model, many other new variables should be taken into account such as spending in advertising or countries of release. Also, interaction between variables should be taken into account. Otherwise, as observed above, the error on the prediction of a new movie is large and so it is its confidence interval at a 95% confidence level.

Additionally, some variables have to be taken very carefuly. For instance, there may be a potential bias with the variable imdb_num_votes. The reason is that the study concerns about movies from all times up to the end of 2016. Old but yet popular movies may well not have received as many votes as recent popular movies since the internet was unavailable when they were released.

Finally, some diagnostics of the model can be done checking whether the MLR conditions hold.

(1) Linear Relationship between (numerical) features and the response variable:

Already checked in section 3. Surprisingly, even though they do not have a linear relationship with the response variable imdb_rating and therefore they did not make it; imdb_num_votes and runtime appear to be significant if included in the model, increasing its prediction power.

(2) The residuals should be nearly normally distributed:

```{r}
hist(model2$residuals)
qqnorm(model2$residuals)
qqline(model2$residuals)
```

The residuals follow a nearly normal distribution even though a slight left skew can be seen on the histogram, or similarly a small deviation from the theoretical line on the normal probability plot.

(3) Constant Variability of the Residuals:

```{r}
plot(model2$residuals ~ model2$fitted) 
```

Although some fan shape can be observed, the majority of the points appear centered around zero with a constant width between -1 and 1.

(4) Independence of Residuals (Independence in observations in our sample)

```{r}
plot(model2$residuals)
```

No significant pattern can be seen over index. Therefore, the independence of the observations can be considered succesful.